(this.webpackJsonpproject=this.webpackJsonpproject||[]).push([[0],{67:function(e,t,a){"use strict";a.r(t);var i,s=a(1),c=a.n(s),r=a(18),n=a.n(r),l=a(7),o=a(6),d=a(10),j=Object(d.a)(),u=a(14),m=a(34),b=a(35),h=a(4),f="All genres",O="Awesome",_="Very good",x="Good",g="Normal",v="Bad",p=10,N=8,w=5,y=3,k="/",S="/login",R="/mylist",D="/films/:id",F="/films/:id/review",E="/player/:id",I="/404",M={OVERVIEW:"Overview",DETAILS:"Details",REVIEWS:"Reviews"},C="AUTH",T="NO_AUTH",q="UNKNOWN",L="/films",P="/login",z="/logout",W="/similar",A="/favorite",Y="/promo",B="/comments",V=a(3),G=a.n(V),H=(G.a.shape({id:G.a.number.isRequired,name:G.a.string.isRequired,posterImage:G.a.string.isRequired,previewImage:G.a.string.isRequired,backgroundImage:G.a.string.isRequired,backgroundColor:G.a.string.isRequired,videoLink:G.a.string.isRequired,previewVideoLink:G.a.string.isRequired,description:G.a.string.isRequired,rating:G.a.number.isRequired,scoresCount:G.a.number.isRequired,director:G.a.string.isRequired,starring:G.a.array.isRequired,runTime:G.a.number.isRequired,genre:G.a.string.isRequired,released:G.a.number.isRequired,isFavorite:G.a.bool.isRequired}).isRequired,a(15)),U=a(2),X="films/changeGenre",J="films/filmsByGenre",K="films/loadFilms",$="films/loadFilm",Q="films/loadPromoFilm",Z="films/loadSimilarFilms",ee="films/loadFavoriteFilms",te="reviews/loadReviews",ae="user/requiredAuthorization",ie="user/logout",se="common/redirectToRoute",ce=function(e){return{type:$,payload:e}},re=function(e){return{type:te,payload:e}},ne=function(e){return{type:ae,payload:e}},le=function(e){return{type:se,payload:e}},oe={genre:f,films:[],film:{},promoFilm:{},similarFilms:[],favoriteFilms:[],isDataLoaded:!1},de={reviews:[]},je={authorizationStatus:q},ue="FILMS_DATA",me="REVIEWS_DATA",be="USER_DATA",he=Object(u.combineReducers)((i={},Object(H.a)(i,ue,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:oe,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case X:return Object(U.a)(Object(U.a)({},e),{},{genre:t.payload});case K:return Object(U.a)(Object(U.a)({},e),{},{films:t.payload,isDataLoaded:!0});case $:return Object(U.a)(Object(U.a)({},e),{},{film:t.payload});case Q:return Object(U.a)(Object(U.a)({},e),{},{promoFilm:t.payload});case Z:return Object(U.a)(Object(U.a)({},e),{},{similarFilms:t.payload});case ee:return Object(U.a)(Object(U.a)({},e),{},{favoriteFilms:t.payload});default:return e}})),Object(H.a)(i,me,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:de,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case te:return Object(U.a)(Object(U.a)({},e),{},{reviews:t.payload});default:return e}})),Object(H.a)(i,be,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:je,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ae:return Object(U.a)(Object(U.a)({},e),{},{authorizationStatus:t.payload});case ie:return Object(U.a)(Object(U.a)({},e),{},{authorizationStatus:T});default:return e}})),i)),fe=function(e){var t=new Set;return t.add(f),e.forEach((function(e){return t.add(e.genre)})),Array.from(t)},Oe=function(e){return e===C},_e=function(e){return e[ue].genre},xe=function(e){return e[ue].films},ge=function(e){return e[ue].film},ve=function(e){return e[ue].promoFilm},pe=function(e){return e[ue].similarFilms},Ne=function(e){return e[ue].favoriteFilms},we=function(e){return t=e[ue].films,(a=e[ue].genre)===f?t:t.slice().filter((function(e){return e.genre===a}));var t,a},ye=function(e){return e[ue].isDataLoaded},ke=function(e){return e[be].authorizationStatus},Se=a(0);var Re=Object(l.b)((function(e){return{authorizationStatus:ke(e)}}))((function(e){var t=e.render,a=e.path,i=e.exact,s=e.authorizationStatus;return Object(Se.jsx)(h.b,{path:a,exact:i,render:function(e){return s===C?t(e):Object(Se.jsx)(h.a,{to:S})}})})),De=a(8),Fe=function(e){return{id:parseInt(e.id,10),name:e.name,posterImage:e.poster_image,previewImage:e.preview_image,backgroundImage:e.background_image,backgroundColor:e.background_color,videoLink:e.video_link,previewVideoLink:e.preview_video_link,description:e.description,rating:e.rating,scoresCount:e.scores_count,director:e.director,starring:e.starring,runTime:e.run_time,genre:e.genre,released:e.released,isFavorite:e.is_favorite}},Ee=function(e){return e.map((function(e){return Fe(e)}))},Ie=function(){return function(e,t,a){return a.get(Y).then((function(t){var a,i=t.data;return e((a=Fe(i),{type:Q,payload:a}))})).catch((function(){return e(le(I))}))}},Me=function(e){return function(t,a,i){return i.get("".concat(L,"/").concat(e).concat(W)).then((function(e){var a,i=e.data;return t((a=Ee(i),{type:Z,payload:a}))}))}},Ce=function(){return function(e,t,a){return a.get(A).then((function(t){var a,i=t.data;return e((a=Ee(i),{type:ee,payload:a}))}))}},Te=function(){return function(e,t,a){return a.delete(z).then((function(){return localStorage.setItem("token","")})).then((function(){return e({type:ie})}))}};var qe=function(){return Object(Se.jsx)("div",{className:"logo",children:Object(Se.jsxs)(o.b,{className:"logo__link",to:k,children:[Object(Se.jsx)("span",{className:"logo__letter logo__letter--1",children:"W"}),Object(Se.jsx)("span",{className:"logo__letter logo__letter--2",children:"T"}),Object(Se.jsx)("span",{className:"logo__letter logo__letter--3",children:"W"})]})})};var Le=Object(l.b)((function(e){return{authorizationStatus:ke(e)}}),(function(e){return{onLogout:function(){e(Te())}}}))((function(e){var t=e.authorizationStatus,a=e.onLogout,i=Object(h.h)();return Oe(t)?Object(Se.jsxs)("ul",{className:"user-block",children:[Object(Se.jsx)("li",{className:"user-block__item",children:Object(Se.jsx)("div",{className:"user-block__avatar",onClick:function(){return i.push(R)},children:Object(Se.jsx)("img",{src:"https://kokinz.github.io/1569955-what-to-watch-7/img/avatar.jpg",alt:"User avatar",width:"63",height:"63"})})}),Object(Se.jsx)("li",{className:"user-block__item",children:Object(Se.jsx)("a",{className:"user-block__link",href:"/",onClick:function(e){e.preventDefault(),a()},children:"Sign out"})})]}):Object(Se.jsx)("div",{className:"user-block",children:Object(Se.jsx)(o.b,{to:S,className:"user-block__link",children:"Sign in"})})}));var Pe=Object(l.b)((function(e){return{authorizationStatus:ke(e)}}),(function(e){return{onSubmit:function(t){e(function(e){var t=e.id,a=e.state;return function(e,i,s){return s.post("".concat(A,"/").concat(t,"/").concat(a)).then((function(t){var a=t.data;return e(ce(Fe(a)))})).catch((function(){}))}}(t))}}}))((function(e){var t=e.film,a=e.authorizationStatus,i=e.onSubmit,c=Object(h.h)(),r=Object(s.useState)(t.isFavorite),n=Object(De.a)(r,2),l=n[0],o=n[1];return Object(s.useEffect)((function(){o(t.isFavorite)}),[t]),Object(Se.jsxs)("button",{className:"btn btn--list film-card__button",type:"button",onClick:function(e){e.preventDefault(),a!==C?c.push(S):o((function(e){var a=e?0:1;return i({id:t.id,state:a}),!e}))},children:[Object(Se.jsx)("svg",{viewBox:"0 0 19 20",width:"19",height:"20",children:Object(Se.jsx)("use",{xlinkHref:l&&a===C?"#in-list":"#add"})}),Object(Se.jsx)("span",{children:"My list"})]})}));var ze=function(e){var t=e.films,a=e.currentGenre,i=e.onGenreChange,s=function(e){e.preventDefault(),i(e.target.textContent)};return Object(Se.jsx)("ul",{className:"catalog__genres-list",children:fe(t).map((function(e,t){return Object(Se.jsx)("li",{className:e===a?"catalog__genres-item catalog__genres-item--active":"catalog__genres-item",children:Object(Se.jsx)("a",{href:"/",className:"catalog__genres-link",onClick:s,children:e})},e)}))})};var We=function(e){var t=e.film,a=t.id,i=t.name,c=t.previewImage,r=t.previewVideoLink,n=Object(s.useState)(null),l=Object(De.a)(n,2),d=l[0],j=l[1],u=Object(s.useRef)(),m=Object(h.h)(),b=function(){clearTimeout(d),u.current.load()};return Object(Se.jsxs)("article",{className:"small-film-card catalog__films-card",onMouseEnter:function(){j(setTimeout((function(){return u.current.play()}),1e3))},onMouseLeave:b,onClick:function(){m.push(Object(h.f)(D,{id:a})),clearTimeout(d)},children:[Object(Se.jsx)("div",{className:"small-film-card__image",children:Object(Se.jsx)("video",{src:r,poster:c,ref:u,width:"280",muted:!0})}),Object(Se.jsx)("h3",{className:"small-film-card__title",children:Object(Se.jsx)(o.b,{className:"small-film-card__link",to:Object(h.f)(D,{id:a}),onClick:b,children:i})})]})};var Ae=function(e){var t=e.films;return Object(Se.jsx)(Se.Fragment,{children:t.map((function(e){return Object(Se.jsx)(We,{film:e},e.id)}))})};var Ye=function(e){var t=e.onShowMoreClick;return Object(Se.jsx)("button",{className:"catalog__button",type:"button",onClick:t,children:"Show more"})};var Be=function(){return Object(Se.jsxs)("footer",{className:"page-footer",children:[Object(Se.jsx)("div",{className:"logo",children:Object(Se.jsxs)(o.b,{className:"logo__link logo__link--light",to:k,children:[Object(Se.jsx)("span",{className:"logo__letter logo__letter--1",children:"W"}),Object(Se.jsx)("span",{className:"logo__letter logo__letter--2",children:"T"}),Object(Se.jsx)("span",{className:"logo__letter logo__letter--3",children:"W"})]})}),Object(Se.jsx)("div",{className:"copyright",children:Object(Se.jsx)("p",{children:"\xa9 2019 What to watch Ltd."})})]})};var Ve=function(){return Object(Se.jsx)("div",{className:"loading-screen",style:{backgroundColor:"#262626",width:"100vw",height:"100vh"},children:Object(Se.jsxs)("div",{className:"ring",children:["Loading",Object(Se.jsx)("span",{className:"point"})]})})};var Ge=Object(l.b)((function(e){return{genre:_e(e),promoFilm:ve(e),films:xe(e),filmsByGenre:we(e)}}),(function(e){return{onGenreChange:function(t){e(function(e){return{type:X,payload:e}}(t)),e({type:J})},loadPromo:function(){e(Ie())}}}))((function(e){var t=e.loadPromo,a=e.films,i=e.genre,c=e.onGenreChange,r=e.filmsByGenre,n=e.promoFilm,l=Object(h.h)(),o=Object(s.useState)(Math.min(r.length,8)),d=Object(De.a)(o,2),j=d[0],u=d[1];return Object(s.useEffect)((function(){u(8)}),[r]),Object(s.useEffect)((function(){if(t(),!n.id)return Object(Se.jsx)(Ve,{})}),[t,n.id]),Object(Se.jsxs)(Se.Fragment,{children:[Object(Se.jsxs)("section",{className:"film-card",children:[Object(Se.jsx)("div",{className:"film-card__bg",children:Object(Se.jsx)("img",{src:n.backgroundImage,alt:n.name})}),Object(Se.jsx)("h1",{className:"visually-hidden",children:"WTW"}),Object(Se.jsxs)("header",{className:"page-header film-card__head",children:[Object(Se.jsx)(qe,{}),Object(Se.jsx)(Le,{})]}),Object(Se.jsx)("div",{className:"film-card__wrap",children:Object(Se.jsxs)("div",{className:"film-card__info",children:[Object(Se.jsx)("div",{className:"film-card__poster",children:Object(Se.jsx)("img",{src:n.posterImage,alt:n.name,width:"218",height:"327"})}),Object(Se.jsxs)("div",{className:"film-card__desc",children:[Object(Se.jsx)("h2",{className:"film-card__title",children:n.name}),Object(Se.jsxs)("p",{className:"film-card__meta",children:[Object(Se.jsx)("span",{className:"film-card__genre",children:n.genre}),Object(Se.jsx)("span",{className:"film-card__year",children:n.released})]}),Object(Se.jsxs)("div",{className:"film-card__buttons",children:[Object(Se.jsxs)("button",{className:"btn btn--play film-card__button",type:"button",onClick:function(){return l.push(Object(h.f)(E,{id:n.id}))},children:[Object(Se.jsx)("svg",{viewBox:"0 0 19 19",width:"19",height:"19",children:Object(Se.jsx)("use",{xlinkHref:"#play-s"})}),Object(Se.jsx)("span",{children:"Play"})]}),Object(Se.jsx)(Pe,{film:n})]})]})]})})]}),Object(Se.jsxs)("div",{className:"page-content",children:[Object(Se.jsxs)("section",{className:"catalog",children:[Object(Se.jsx)("h2",{className:"catalog__title visually-hidden",children:"Catalog"}),Object(Se.jsx)(ze,{films:a,currentGenre:i,onGenreChange:c}),Object(Se.jsx)("div",{className:"catalog__films-list",children:Object(Se.jsx)(Ae,{films:r.slice(0,j)})}),Object(Se.jsx)("div",{className:"catalog__more",children:j<r.length?Object(Se.jsx)(Ye,{onShowMoreClick:function(){u(j+8)}}):""})]}),Object(Se.jsx)(Be,{})]})]})}));var He=Object(l.b)((function(e){return{authorizationStatus:ke(e)}}),(function(e){return{onSubmit:function(t){e(function(e){var t=e.login,a=e.password;return function(e,i,s){return s.post(P,{email:t,password:a}).then((function(e){var t=e.data;return localStorage.setItem("token",t.token)})).then((function(){return e(ne(C))}))}}(t))}}}))((function(e){var t=e.authorizationStatus,a=e.onSubmit,i=Object(s.useRef)(),c=Object(s.useRef)(),r=Object(s.useState)({isEmailError:!1,isPasswordError:!1}),n=Object(De.a)(r,2),l=n[0],o=n[1];return Oe(t)?Object(Se.jsx)(h.a,{to:k}):Object(Se.jsxs)("div",{className:"user-page",children:[Object(Se.jsxs)("header",{className:"page-header user-page__head",children:[Object(Se.jsx)(qe,{}),Object(Se.jsx)("h1",{className:"page-title user-page__title",children:"Sign in"})]}),Object(Se.jsx)("div",{className:"sign-in user-page__content",children:Object(Se.jsxs)("form",{action:"#",className:"sign-in__form",children:[l.isEmailError?Object(Se.jsx)("div",{className:"sign-in__message",children:Object(Se.jsx)("p",{children:"Please enter a valid email address"})}):"",l.isPasswordError?Object(Se.jsx)("div",{className:"sign-in__message",children:Object(Se.jsxs)("p",{children:["We can\u2019t recognize this email ",Object(Se.jsx)("br",{})," and password combination. Please try again."]})}):"",Object(Se.jsxs)("div",{className:"sign-in__fields",children:[Object(Se.jsxs)("div",{className:"sign-in__field",children:[Object(Se.jsx)("input",{ref:i,className:"sign-in__input",type:"email",placeholder:"Email address",name:"user-email",id:"user-email","data-testid":"login"}),Object(Se.jsx)("label",{className:"sign-in__label visually-hidden",htmlFor:"user-email",children:"Email address"})]}),Object(Se.jsxs)("div",{className:"sign-in__field",children:[Object(Se.jsx)("input",{ref:c,className:"sign-in__input",type:"password",placeholder:"Password",name:"user-password",id:"user-password","data-testid":"password"}),Object(Se.jsx)("label",{className:"sign-in__label visually-hidden",htmlFor:"user-password",children:"Password"})]})]}),Object(Se.jsx)("div",{className:"sign-in__submit",children:Object(Se.jsx)("button",{className:"sign-in__btn",type:"submit",onClick:function(e){e.preventDefault(),/^[\w-.]+@[\w-]+\.[a-z]{2,4}$/i.test(i.current.value)?0!==c.current.value.trim().length?a({login:i.current.value,password:c.current.value}):o(Object(U.a)(Object(U.a)({},l),{},{isPasswordError:!0})):o(Object(U.a)(Object(U.a)({},l),{},{isEmailError:!0}))},children:"Sign in"})})]})}),Object(Se.jsx)(Be,{})]})}));var Ue=Object(l.b)((function(e){return{favoriteFilms:Ne(e)}}),(function(e){return{loadData:function(){e(Ce())}}}))((function(e){var t=e.favoriteFilms,a=e.loadData;return Object(s.useEffect)((function(){a()}),[a]),Object(Se.jsxs)("div",{className:"user-page",children:[Object(Se.jsxs)("header",{className:"page-header user-page__head",children:[Object(Se.jsx)(qe,{}),Object(Se.jsx)("h1",{className:"page-title user-page__title",children:"My list"}),Object(Se.jsx)(Le,{})]}),Object(Se.jsxs)("section",{className:"catalog",children:[Object(Se.jsx)("h2",{className:"catalog__title visually-hidden",children:"Catalog"}),Object(Se.jsx)("div",{className:"catalog__films-list",children:Object(Se.jsx)(Ae,{films:t})})]}),Object(Se.jsx)(Be,{})]})})),Xe=(G.a.shape({id:G.a.number.isRequired,rating:G.a.number.isRequired,comment:G.a.string.isRequired,date:G.a.string.isRequired,user:G.a.shape({id:G.a.number.isRequired,name:G.a.string.isRequired}).isRequired}).isRequired,function(e){return e[me].reviews});var Je=function(e){var t,a=e.film;return Object(Se.jsxs)(Se.Fragment,{children:[Object(Se.jsxs)("div",{className:"film-rating",children:[Object(Se.jsx)("div",{className:"film-rating__score",children:a.rating}),Object(Se.jsxs)("p",{className:"film-rating__meta",children:[Object(Se.jsx)("span",{className:"film-rating__level",children:(t=a.rating,Math.trunc(t)===p?O:Math.trunc(t)>=N?_:Math.trunc(t)>=w?x:Math.trunc(t)>=y?g:v)}),Object(Se.jsxs)("span",{className:"film-rating__count",children:[a.scoresCount," ratings"]})]})]}),Object(Se.jsxs)("div",{className:"film-card__text",children:[Object(Se.jsx)("p",{children:a.description}),Object(Se.jsx)("p",{className:"film-card__director",children:Object(Se.jsxs)("strong",{children:["Director: ",a.director]})}),Object(Se.jsx)("p",{className:"film-card__starring",children:Object(Se.jsxs)("strong",{children:["Starring: ",a.starring.slice(0,3).join(", ")," and other"]})})]})]})};var Ke=function(e){var t=e.film;return Object(Se.jsxs)("div",{className:"film-card__text film-card__row",children:[Object(Se.jsxs)("div",{className:"film-card__text-col",children:[Object(Se.jsxs)("p",{className:"film-card__details-item",children:[Object(Se.jsx)("strong",{className:"film-card__details-name",children:"Director"}),Object(Se.jsx)("span",{className:"film-card__details-value",children:t.director})]}),Object(Se.jsxs)("p",{className:"film-card__details-item",children:[Object(Se.jsx)("strong",{className:"film-card__details-name",children:"Starring"}),Object(Se.jsx)("span",{className:"film-card__details-value",children:t.starring.slice().join(",_").split("_").map((function(e){return Object(Se.jsxs)(c.a.Fragment,{children:[e,Object(Se.jsx)("br",{})]},e)}))})]})]}),Object(Se.jsxs)("div",{className:"film-card__text-col",children:[Object(Se.jsxs)("p",{className:"film-card__details-item",children:[Object(Se.jsx)("strong",{className:"film-card__details-name",children:"Run Time"}),Object(Se.jsxs)("span",{className:"film-card__details-value",children:[0===Math.floor(t.runTime/60)?"":"".concat(Math.floor(t.runTime/60),"h ")," ",t.runTime%60,"m"]})]}),Object(Se.jsxs)("p",{className:"film-card__details-item",children:[Object(Se.jsx)("strong",{className:"film-card__details-name",children:"Genre"}),Object(Se.jsx)("span",{className:"film-card__details-value",children:t.genre})]}),Object(Se.jsxs)("p",{className:"film-card__details-item",children:[Object(Se.jsx)("strong",{className:"film-card__details-name",children:"Released"}),Object(Se.jsx)("span",{className:"film-card__details-value",children:t.released})]})]})]})},$e=a(20),Qe=a.n($e),Ze=a(17),et=a.n(Ze);var tt=function(e){var t=e.reviews;return Object(Se.jsxs)("div",{className:"film-card__reviews film-card__row",children:[Object(Se.jsx)("div",{className:"film-card__reviews-col",children:t.slice(0,Math.ceil(t.length/2)).map((function(e){return Object(Se.jsxs)("div",{className:"review",children:[Object(Se.jsxs)("blockquote",{className:"review__quote",children:[Object(Se.jsx)("p",{className:"review__text",children:e.comment}),Object(Se.jsxs)("footer",{className:"review__details",children:[Object(Se.jsx)("cite",{className:"review__author",children:e.user.name}),Object(Se.jsx)("time",{className:"review__date",dateTime:Qe()(e.date).format("YYYY-MM-DD"),children:Object(Se.jsx)(et.a,{format:"MMMM D, YYYY",children:e.date})})]})]}),Object(Se.jsx)("div",{className:"review__rating",children:e.rating})]},e.id)}))}),Object(Se.jsx)("div",{className:"film-card__reviews-col",children:t.slice(Math.ceil(t.length/2)).map((function(e){return Object(Se.jsxs)("div",{className:"review",children:[Object(Se.jsxs)("blockquote",{className:"review__quote",children:[Object(Se.jsx)("p",{className:"review__text",children:e.comment}),Object(Se.jsxs)("footer",{className:"review__details",children:[Object(Se.jsx)("cite",{className:"review__author",children:e.user.name}),Object(Se.jsx)("time",{className:"review__date",dateTime:Qe()(e.date).format("YYYY-MM-DD"),children:Object(Se.jsx)(et.a,{format:"MMMM D, YYYY",children:e.date})})]})]}),Object(Se.jsx)("div",{className:"review__rating",children:e.rating})]},e.id)}))})]})};var at=function(e){var t=e.film,a=e.reviews,i=Object(s.useState)(M.OVERVIEW),c=Object(De.a)(i,2),r=c[0],n=c[1],l=Object.values(M),o=function(e){e.preventDefault(),n(e.target.innerText)};return Object(Se.jsxs)("div",{className:"film-card__desc",children:[Object(Se.jsx)("nav",{className:"film-nav film-card__nav",children:Object(Se.jsx)("ul",{className:"film-nav__list",children:l.map((function(e){return Object(Se.jsx)("li",{className:e===r?"film-nav__item film-nav__item--active":"film-nav__item",children:Object(Se.jsx)("a",{href:"/",className:"film-nav__link",onClick:o,children:e})},e)}))})}),r===M.OVERVIEW&&Object(Se.jsx)(Je,{film:t}),r===M.DETAILS&&Object(Se.jsx)(Ke,{film:t}),r===M.REVIEWS&&Object(Se.jsx)(tt,{reviews:a})]})};var it=Object(l.b)((function(e){return{film:ge(e),similarFilms:pe(e),reviews:Xe(e),authorizationStatus:ke(e)}}),(function(e){return{loadData:function(t){var a;e((a=t,function(e,t,i){return i.get("".concat(L,"/").concat(a)).then((function(t){var a=t.data;return e(ce(Fe(a)))})).catch((function(){return e(le(I))}))})),e(Me(t)),e(function(e){return function(t,a,i){return i.get("".concat(B,"/").concat(e)).then((function(e){var a=e.data;return t(re(a))}))}}(t))}}}))((function(e){var t=e.film,a=e.similarFilms,i=e.reviews,c=e.loadData,r=e.authorizationStatus,n=parseInt(Object(h.i)().id,10),l=Object(h.h)(),d=a.filter((function(e){return e.id!==n})).slice(0,4);return Object(s.useEffect)((function(){if(c(n),n!==t.id)return Object(Se.jsx)(Ve,{})}),[n,t.id,c]),Object(Se.jsxs)(Se.Fragment,{children:[Object(Se.jsxs)("section",{className:"film-card film-card--full",children:[Object(Se.jsxs)("div",{className:"film-card__hero",children:[Object(Se.jsx)("div",{className:"film-card__bg",children:Object(Se.jsx)("img",{src:t.backgroundImage,alt:t.name})}),Object(Se.jsx)("h1",{className:"visually-hidden",children:"WTW"}),Object(Se.jsxs)("header",{className:"page-header film-card__head",children:[Object(Se.jsx)(qe,{}),Object(Se.jsx)(Le,{})]}),Object(Se.jsx)("div",{className:"film-card__wrap",children:Object(Se.jsxs)("div",{className:"film-card__desc",children:[Object(Se.jsx)("h2",{className:"film-card__title",children:t.name}),Object(Se.jsxs)("p",{className:"film-card__meta",children:[Object(Se.jsx)("span",{className:"film-card__genre",children:t.genre}),Object(Se.jsx)("span",{className:"film-card__year",children:t.released})]}),Object(Se.jsxs)("div",{className:"film-card__buttons",children:[Object(Se.jsxs)("button",{className:"btn btn--play film-card__button",type:"button",onClick:function(){return l.push(Object(h.f)(E,{id:n}))},children:[Object(Se.jsx)("svg",{viewBox:"0 0 19 19",width:19,height:19,children:Object(Se.jsx)("use",{xlinkHref:"#play-s"})}),Object(Se.jsx)("span",{children:"Play"})]}),Object(Se.jsx)(Pe,{film:t}),Oe(r)?Object(Se.jsx)(o.b,{className:"btn film-card__button",to:Object(h.f)(F,{id:n}),children:"Add review"}):""]})]})})]}),Object(Se.jsx)("div",{className:"film-card__wrap film-card__translate-top",children:Object(Se.jsxs)("div",{className:"film-card__info",children:[Object(Se.jsx)("div",{className:"film-card__poster film-card__poster--big",children:Object(Se.jsx)("img",{src:t.posterImage,alt:"The Grand Budapest Hotel poster",width:218,height:327})}),t.id?Object(Se.jsx)(at,{film:t,reviews:i}):""]})})]}),Object(Se.jsxs)("div",{className:"page-content",children:[Object(Se.jsxs)("section",{className:"catalog catalog--like-this",children:[d.length?Object(Se.jsx)("h2",{className:"catalog__title",children:"More like this"}):"",Object(Se.jsx)("div",{className:"catalog__films-list",children:Object(Se.jsx)(Ae,{films:d})})]}),Object(Se.jsx)(Be,{})]})]})}));var st=function(e){var t=e.index,a=e.value,i=e.handleRatingChange,s=e.isDisabled;return Object(Se.jsxs)(Se.Fragment,{children:[Object(Se.jsx)("input",{className:"rating__input",id:"star-".concat(t),type:"radio",name:"rating",defaultValue:t,checked:a===t,onChange:i,disabled:s}),Object(Se.jsxs)("label",{className:"rating__label",htmlFor:"star-".concat(t),children:["Rating ",t]})]})};var ct=Object(l.b)(null,(function(e){return{onSubmit:function(t,a){e(function(e,t){var a=e.id,i=e.rating,s=e.comment;return function(e,c,r){return r.post("".concat(B,"/").concat(a),{rating:i,comment:s}).then((function(t){var a=t.data;return e(re(a))})).then((function(){return e(le(Object(h.f)(D,{id:a})))})).catch((function(){return t()}))}}(t,a))}}}))((function(e){var t=e.id,a=e.onSubmit,i=Object(s.useState)({rating:7,comment:"",isButtonDisabled:!0,isFormDisabled:!1,isSubmitError:!1}),c=Object(De.a)(i,2),r=c[0],n=c[1],l=r.rating,o=r.comment,d=function(e){n(Object(U.a)(Object(U.a)({},r),{},{rating:Number(e.target.value)}))},j=function(){n(Object(U.a)(Object(U.a)({},r),{},{isSubmitError:!0,isFormDisabled:!0})),setTimeout((function(){n(Object(U.a)(Object(U.a)({},r),{},{isSubmitError:!1,isFormDisabled:!1}))}),4500)};return Object(Se.jsxs)("form",{action:"#",className:"add-review__form",onSubmit:function(e){e.preventDefault(),n(Object(U.a)(Object(U.a)({},r),{},{isFormDisabled:!0})),a({id:t,rating:r.rating,comment:r.comment},j)},children:[Object(Se.jsx)("div",{className:"rating",children:Object(Se.jsx)("div",{className:"rating__stars",children:Array.from({length:10}).map((function(e,t){var a="".concat(e,"-").concat(t);return Object(Se.jsx)(st,{index:10-t,value:l,handleRatingChange:d,isDisabled:r.isFormDisabled},a)}))})}),Object(Se.jsxs)("div",{className:"add-review__text",children:[Object(Se.jsx)("textarea",{className:"add-review__textarea",name:"review-text",id:"review-text",cols:30,placeholder:"Review text",value:o,maxLength:400,onInput:function(e){var t=e.target.value.length;n(t>=50?Object(U.a)(Object(U.a)({},r),{},{isButtonDisabled:!1,comment:e.target.value}):Object(U.a)(Object(U.a)({},r),{},{isButtonDisabled:!0,comment:e.target.value}))},disabled:r.isFormDisabled}),Object(Se.jsx)("div",{className:"add-review__submit",children:r.isSubmitError?Object(Se.jsx)("p",{style:{color:"#FF0000"},children:"\u041e\u0448\u0438\u0431\u043a\u0430 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u043e\u0442\u0437\u044b\u0432\u0430"}):Object(Se.jsx)("button",{className:"add-review__btn",type:"submit",disabled:r.isButtonDisabled||r.isFormDisabled,children:"Post"})})]})]})}));var rt=function(e){var t=e.films,a=parseInt(Object(h.i)().id,10),i=t.find((function(e){return e.id===a}));return Object(Se.jsxs)("section",{className:"film-card film-card--full",children:[Object(Se.jsxs)("div",{className:"film-card__header",children:[Object(Se.jsx)("div",{className:"film-card__bg",children:Object(Se.jsx)("img",{src:i.backgroundImage,alt:i.name})}),Object(Se.jsx)("h1",{className:"visually-hidden",children:"WTW"}),Object(Se.jsxs)("header",{className:"page-header",children:[Object(Se.jsx)(qe,{}),Object(Se.jsx)("nav",{className:"breadcrumbs",children:Object(Se.jsxs)("ul",{className:"breadcrumbs__list",children:[Object(Se.jsx)("li",{className:"breadcrumbs__item",children:Object(Se.jsx)(o.b,{to:Object(h.f)(D,{id:a}),className:"breadcrumbs__link",children:i.name})}),Object(Se.jsx)("li",{className:"breadcrumbs__item",children:Object(Se.jsx)("a",{className:"breadcrumbs__link",href:"/",onClick:function(e){return e.preventDefault()},children:"Add review"})})]})}),Object(Se.jsx)(Le,{})]}),Object(Se.jsx)("div",{className:"film-card__poster film-card__poster--small",children:Object(Se.jsx)("img",{src:i.posterImage,alt:i.name,width:218,height:327})})]}),Object(Se.jsx)("div",{className:"add-review",children:Object(Se.jsx)(ct,{id:a})})]})},nt=a(37);var lt=function(e){var t=e.films,a=parseInt(Object(h.i)().id,10),i=t.find((function(e){return e.id===a})),c=Object(h.h)(),r=Object(s.useRef)(),n=Object(s.useRef)(),l=Object(s.useRef)(),o=Object(s.useState)({isPlaying:!1,elapsedTime:""}),d=Object(De.a)(o,2),j=d[0],u=d[1],m=j.isPlaying,b=i.runTime,f=Object(nt.a)({duration:60*b,isPlaying:m}).elapsedTime,O=Math.ceil(60*b-f);return Object(Se.jsxs)("div",{className:"player",children:[Object(Se.jsx)("video",{ref:r,src:i.videoLink,className:"player__video",poster:i.posterImage}),Object(Se.jsx)("button",{type:"button",className:"player__exit",onClick:function(){return c.push(Object(h.f)(D,{id:a}))},children:"Exit"}),Object(Se.jsxs)("div",{className:"player__controls",children:[Object(Se.jsxs)("div",{className:"player__controls-row",children:[Object(Se.jsxs)("div",{className:"player__time",children:[Object(Se.jsx)("progress",{className:"player__progress",value:30,max:100}),Object(Se.jsx)("div",{className:"player__toggler",style:{left:"".concat(Math.floor(f/(60*b)*100))},children:"Toggler"})]}),Object(Se.jsx)("div",{className:"player__time-value",children:Object(Se.jsx)(et.a,{unix:!0,format:"-HH:mm:ss",children:O})})]}),Object(Se.jsxs)("div",{className:"player__controls-row",children:[Object(Se.jsxs)("button",{ref:n,type:"button",className:"player__play",onClick:function(e){e.preventDefault(),r.current.paused?(r.current.play(),u((function(e){return Object(U.a)(Object(U.a)({},e),{},{isPlaying:!0})}))):(r.current.pause(),u((function(e){return Object(U.a)(Object(U.a)({},e),{},{isPlaying:!1})})))},children:[Object(Se.jsx)("svg",{viewBox:"0 0 19 19",width:19,height:19,children:Object(Se.jsx)("use",{xlinkHref:j.isPlaying?"#pause":"#play-s"})}),Object(Se.jsx)("span",{children:"Play"})]}),Object(Se.jsx)("div",{className:"player__name",children:i.name}),Object(Se.jsxs)("button",{ref:l,type:"button",className:"player__full-screen",onClick:function(e){e.preventDefault(),r.current.requestFullscreen()},children:[Object(Se.jsx)("svg",{viewBox:"0 0 27 27",width:27,height:27,children:Object(Se.jsx)("use",{xlinkHref:"#full-screen"})}),Object(Se.jsx)("span",{children:"Full screen"})]})]})]})]})};var ot=function(){return Object(Se.jsxs)("div",{className:"user-page",children:[Object(Se.jsxs)("section",{children:[Object(Se.jsx)("h1",{children:"404. Page not found"}),Object(Se.jsx)("a",{href:k,children:"\u0412\u0435\u0440\u043d\u0443\u0442\u044c\u0441\u044f \u043d\u0430 \u0433\u043b\u0430\u0432\u043d\u0443\u044e"})]}),Object(Se.jsx)(Be,{})]})};var dt=Object(l.b)((function(e){return{films:xe(e),authorizationStatus:ke(e),isDataLoaded:ye(e)}}),null)((function(e){var t=e.films,a=e.authorizationStatus,i=e.isDataLoaded;return a!==q&&i?Object(Se.jsxs)(h.d,{children:[Object(Se.jsx)(h.b,{exact:!0,path:k,children:Object(Se.jsx)(Ge,{})}),Object(Se.jsx)(h.b,{exact:!0,path:S,children:Object(Se.jsx)(He,{})}),Object(Se.jsx)(Re,{exact:!0,path:R,render:function(){return Object(Se.jsx)(Ue,{films:t})}}),Object(Se.jsx)(h.b,{exact:!0,path:D,children:Object(Se.jsx)(it,{films:t})}),Object(Se.jsx)(Re,{exact:!0,path:F,render:function(){return Object(Se.jsx)(rt,{films:t})}}),Object(Se.jsx)(h.b,{exact:!0,path:E,children:Object(Se.jsx)(lt,{films:t})}),Object(Se.jsx)(h.b,{children:Object(Se.jsx)(ot,{path:I})})]}):Object(Se.jsx)(Ve,{})})),jt=a(36),ut=a.n(jt),mt=401,bt=204,ht=Object(u.createStore)(he,Object(b.composeWithDevTools)(Object(u.applyMiddleware)(m.a.withExtraArgument(function(e){var t,a=null!==(t=localStorage.getItem("token"))&&void 0!==t?t:"",i=ut.a.create({baseURL:"https://7.react.pages.academy/wtw",timeout:5e3,headers:{"X-Token":a}});return i.interceptors.response.use((function(e){var t=e.data;return t.token&&!localStorage.getItem("token")&&(i.defaults.headers.common["X-token"]=t.token,localStorage.setItem("token",t.token)),e.status===bt&&(i.defaults.headers.common["X-token"]="",localStorage.setItem("token","")),e}),(function(t){throw t.response.status===mt&&e(),t})),i}((function(){return ht.dispatch(ne(T))})))),Object(u.applyMiddleware)((function(e){return function(e){return function(t){return t.type===se&&j.push(t.payload),e(t)}}}))));ht.dispatch((function(e,t,a){return a.get(P).then((function(){return e(ne(C))})).catch((function(){}))})),ht.dispatch((function(e,t,a){return a.get(L).then((function(t){var a,i=t.data;return e((a=Ee(i),{type:K,payload:a}))}))})),n.a.render(Object(Se.jsx)(c.a.StrictMode,{children:Object(Se.jsx)(l.a,{store:ht,children:Object(Se.jsx)(o.a,{history:j,children:Object(Se.jsx)(dt,{})})})}),document.getElementById("root")),window.onbeforeunload=function(e){e.preventDefault(),e&&j.push(k)}}},[[67,1,2]]]);
//# sourceMappingURL=main.ebe8f889.chunk.js.map