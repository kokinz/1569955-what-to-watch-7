(this.webpackJsonpproject=this.webpackJsonpproject||[]).push([[0],{67:function(e,t,a){"use strict";a.r(t);var i,c=a(1),s=a.n(c),r=a(18),n=a.n(r),l=a(6),o=a(4),d=a(10),j=Object(d.a)(),u=a(14),m=a(34),b=a(35),h="All genres",f="Awesome",O="Very good",_="Good",x="Normal",g="Bad",v=10,p=8,N=5,w=3,y="/1569955-what-to-watch-7",k="/1569955-what-to-watch-7/login",S="/1569955-what-to-watch-7/mylist",R="/1569955-what-to-watch-7/films/:id",D="/1569955-what-to-watch-7/films/:id/review",F="/1569955-what-to-watch-7/player/:id",E="/1569955-what-to-watch-7/404",I={OVERVIEW:"Overview",DETAILS:"Details",REVIEWS:"Reviews"},M="AUTH",C="NO_AUTH",T="UNKNOWN",q="/films",L="/login",P="/logout",z="/similar",W="/favorite",A="/promo",Y="/comments",B=a(3),V=a.n(B),G=(V.a.shape({id:V.a.number.isRequired,name:V.a.string.isRequired,posterImage:V.a.string.isRequired,previewImage:V.a.string.isRequired,backgroundImage:V.a.string.isRequired,backgroundColor:V.a.string.isRequired,videoLink:V.a.string.isRequired,previewVideoLink:V.a.string.isRequired,description:V.a.string.isRequired,rating:V.a.number.isRequired,scoresCount:V.a.number.isRequired,director:V.a.string.isRequired,starring:V.a.array.isRequired,runTime:V.a.number.isRequired,genre:V.a.string.isRequired,released:V.a.number.isRequired,isFavorite:V.a.bool.isRequired}).isRequired,a(15)),H=a(2),U="films/changeGenre",X="films/filmsByGenre",J="films/loadFilms",K="films/loadFilm",$="films/loadPromoFilm",Q="films/loadSimilarFilms",Z="films/loadFavoriteFilms",ee="reviews/loadReviews",te="user/requiredAuthorization",ae="user/logout",ie="common/redirectToRoute",ce=function(e){return{type:K,payload:e}},se=function(e){return{type:ee,payload:e}},re=function(e){return{type:te,payload:e}},ne=function(e){return{type:ie,payload:e}},le={genre:h,films:[],film:{},promoFilm:{},similarFilms:[],favoriteFilms:[],isDataLoaded:!1},oe={reviews:[]},de={authorizationStatus:T},je="FILMS_DATA",ue="REVIEWS_DATA",me="USER_DATA",be=Object(u.combineReducers)((i={},Object(G.a)(i,je,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:le,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case U:return Object(H.a)(Object(H.a)({},e),{},{genre:t.payload});case J:return Object(H.a)(Object(H.a)({},e),{},{films:t.payload,isDataLoaded:!0});case K:return Object(H.a)(Object(H.a)({},e),{},{film:t.payload});case $:return Object(H.a)(Object(H.a)({},e),{},{promoFilm:t.payload});case Q:return Object(H.a)(Object(H.a)({},e),{},{similarFilms:t.payload});case Z:return Object(H.a)(Object(H.a)({},e),{},{favoriteFilms:t.payload});default:return e}})),Object(G.a)(i,ue,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:oe,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ee:return Object(H.a)(Object(H.a)({},e),{},{reviews:t.payload});default:return e}})),Object(G.a)(i,me,(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:de,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case te:return Object(H.a)(Object(H.a)({},e),{},{authorizationStatus:t.payload});case ae:return Object(H.a)(Object(H.a)({},e),{},{authorizationStatus:C});default:return e}})),i)),he=function(e){var t=new Set;return t.add(h),e.forEach((function(e){return t.add(e.genre)})),Array.from(t)},fe=function(e){return e===M},Oe=function(e){return e[je].genre},_e=function(e){return e[je].films},xe=function(e){return e[je].film},ge=function(e){return e[je].promoFilm},ve=function(e){return e[je].similarFilms},pe=function(e){return e[je].favoriteFilms},Ne=function(e){return t=e[je].films,(a=e[je].genre)===h?t:t.slice().filter((function(e){return e.genre===a}));var t,a},we=function(e){return e[je].isDataLoaded},ye=function(e){return e[me].authorizationStatus},ke=a(0);var Se=Object(l.b)((function(e){return{authorizationStatus:ye(e)}}))((function(e){var t=e.render,a=e.path,i=e.exact,c=e.authorizationStatus;return Object(ke.jsx)(o.b,{path:a,exact:i,render:function(e){return c===M?t(e):Object(ke.jsx)(o.a,{to:k})}})})),Re=a(8),De=function(e){return{id:parseInt(e.id,10),name:e.name,posterImage:e.poster_image,previewImage:e.preview_image,backgroundImage:e.background_image,backgroundColor:e.background_color,videoLink:e.video_link,previewVideoLink:e.preview_video_link,description:e.description,rating:e.rating,scoresCount:e.scores_count,director:e.director,starring:e.starring,runTime:e.run_time,genre:e.genre,released:e.released,isFavorite:e.is_favorite}},Fe=function(e){return e.map((function(e){return De(e)}))},Ee=function(){return function(e,t,a){return a.get(A).then((function(t){var a,i=t.data;return e((a=De(i),{type:$,payload:a}))})).catch((function(){return e(ne(E))}))}},Ie=function(e){return function(t,a,i){return i.get("".concat(q,"/").concat(e).concat(z)).then((function(e){var a,i=e.data;return t((a=Fe(i),{type:Q,payload:a}))}))}},Me=function(){return function(e,t,a){return a.get(W).then((function(t){var a,i=t.data;return e((a=Fe(i),{type:Z,payload:a}))}))}},Ce=function(){return function(e,t,a){return a.delete(P).then((function(){return localStorage.setItem("token","")})).then((function(){return e({type:ae})}))}},Te=a(7);var qe=function(){return Object(ke.jsx)("div",{className:"logo",children:Object(ke.jsxs)(Te.a,{className:"logo__link",to:y,children:[Object(ke.jsx)("span",{className:"logo__letter logo__letter--1",children:"W"}),Object(ke.jsx)("span",{className:"logo__letter logo__letter--2",children:"T"}),Object(ke.jsx)("span",{className:"logo__letter logo__letter--3",children:"W"})]})})};var Le=Object(l.b)((function(e){return{authorizationStatus:ye(e)}}),(function(e){return{onLogout:function(){e(Ce())}}}))((function(e){var t=e.authorizationStatus,a=e.onLogout,i=Object(o.h)();return fe(t)?Object(ke.jsxs)("ul",{className:"user-block",children:[Object(ke.jsx)("li",{className:"user-block__item",children:Object(ke.jsx)("div",{className:"user-block__avatar",onClick:function(){return i.push(S)},children:Object(ke.jsx)("img",{src:"https://kokinz.github.io/1569955-what-to-watch-7/img/avatar.jpg",alt:"User avatar",width:"63",height:"63"})})}),Object(ke.jsx)("li",{className:"user-block__item",children:Object(ke.jsx)("a",{className:"user-block__link",href:"/",onClick:function(e){e.preventDefault(),a()},children:"Sign out"})})]}):Object(ke.jsx)("div",{className:"user-block",children:Object(ke.jsx)(Te.a,{to:k,className:"user-block__link",children:"Sign in"})})}));var Pe=Object(l.b)((function(e){return{authorizationStatus:ye(e)}}),(function(e){return{onSubmit:function(t){e(function(e){var t=e.id,a=e.state;return function(e,i,c){return c.post("".concat(W,"/").concat(t,"/").concat(a)).then((function(t){var a=t.data;return e(ce(De(a)))})).catch((function(){}))}}(t))}}}))((function(e){var t=e.film,a=e.authorizationStatus,i=e.onSubmit,s=Object(o.h)(),r=Object(c.useState)(t.isFavorite),n=Object(Re.a)(r,2),l=n[0],d=n[1];return Object(c.useEffect)((function(){d(t.isFavorite)}),[t]),Object(ke.jsxs)("button",{className:"btn btn--list film-card__button",type:"button",onClick:function(e){e.preventDefault(),a!==M?s.push(k):d((function(e){var a=e?0:1;return i({id:t.id,state:a}),!e}))},children:[Object(ke.jsx)("svg",{viewBox:"0 0 19 20",width:"19",height:"20",children:Object(ke.jsx)("use",{xlinkHref:l&&a===M?"#in-list":"#add"})}),Object(ke.jsx)("span",{children:"My list"})]})}));var ze=function(e){var t=e.films,a=e.currentGenre,i=e.onGenreChange,c=function(e){e.preventDefault(),i(e.target.textContent)};return Object(ke.jsx)("ul",{className:"catalog__genres-list",children:he(t).map((function(e,t){return Object(ke.jsx)("li",{className:e===a?"catalog__genres-item catalog__genres-item--active":"catalog__genres-item",children:Object(ke.jsx)("a",{href:"/",className:"catalog__genres-link",onClick:c,children:e})},e)}))})};var We=function(e){var t=e.film,a=t.id,i=t.name,s=t.previewImage,r=t.previewVideoLink,n=Object(c.useState)(null),l=Object(Re.a)(n,2),d=l[0],j=l[1],u=Object(c.useRef)(),m=Object(o.h)(),b=function(){clearTimeout(d),u.current.load()};return Object(ke.jsxs)("article",{className:"small-film-card catalog__films-card",onMouseEnter:function(){j(setTimeout((function(){return u.current.play()}),1e3))},onMouseLeave:b,onClick:function(){m.push(Object(o.f)(R,{id:a})),clearTimeout(d)},children:[Object(ke.jsx)("div",{className:"small-film-card__image",children:Object(ke.jsx)("video",{src:r,poster:s,ref:u,width:"280",muted:!0})}),Object(ke.jsx)("h3",{className:"small-film-card__title",children:Object(ke.jsx)(Te.a,{className:"small-film-card__link",to:Object(o.f)(R,{id:a}),onClick:b,children:i})})]})};var Ae=function(e){var t=e.films;return Object(ke.jsx)(ke.Fragment,{children:t.map((function(e){return Object(ke.jsx)(We,{film:e},e.id)}))})};var Ye=function(e){var t=e.onShowMoreClick;return Object(ke.jsx)("button",{className:"catalog__button",type:"button",onClick:t,children:"Show more"})};var Be=function(){return Object(ke.jsxs)("footer",{className:"page-footer",children:[Object(ke.jsx)("div",{className:"logo",children:Object(ke.jsxs)(Te.a,{className:"logo__link logo__link--light",to:y,children:[Object(ke.jsx)("span",{className:"logo__letter logo__letter--1",children:"W"}),Object(ke.jsx)("span",{className:"logo__letter logo__letter--2",children:"T"}),Object(ke.jsx)("span",{className:"logo__letter logo__letter--3",children:"W"})]})}),Object(ke.jsx)("div",{className:"copyright",children:Object(ke.jsx)("p",{children:"\xa9 2019 What to watch Ltd."})})]})};var Ve=function(){return Object(ke.jsx)("div",{className:"loading-screen",style:{backgroundColor:"#262626",width:"100vw",height:"100vh"},children:Object(ke.jsxs)("div",{className:"ring",children:["Loading",Object(ke.jsx)("span",{className:"point"})]})})};var Ge=Object(l.b)((function(e){return{genre:Oe(e),promoFilm:ge(e),films:_e(e),filmsByGenre:Ne(e)}}),(function(e){return{onGenreChange:function(t){e(function(e){return{type:U,payload:e}}(t)),e({type:X})},loadPromo:function(){e(Ee())}}}))((function(e){var t=e.loadPromo,a=e.films,i=e.genre,s=e.onGenreChange,r=e.filmsByGenre,n=e.promoFilm,l=Object(o.h)(),d=Object(c.useState)(Math.min(r.length,8)),j=Object(Re.a)(d,2),u=j[0],m=j[1];return Object(c.useEffect)((function(){m(8)}),[r]),Object(c.useEffect)((function(){if(t(),!n.id)return Object(ke.jsx)(Ve,{})}),[t,n.id]),Object(ke.jsxs)(ke.Fragment,{children:[Object(ke.jsxs)("section",{className:"film-card",children:[Object(ke.jsx)("div",{className:"film-card__bg",children:Object(ke.jsx)("img",{src:n.backgroundImage,alt:n.name})}),Object(ke.jsx)("h1",{className:"visually-hidden",children:"WTW"}),Object(ke.jsxs)("header",{className:"page-header film-card__head",children:[Object(ke.jsx)(qe,{}),Object(ke.jsx)(Le,{})]}),Object(ke.jsx)("div",{className:"film-card__wrap",children:Object(ke.jsxs)("div",{className:"film-card__info",children:[Object(ke.jsx)("div",{className:"film-card__poster",children:Object(ke.jsx)("img",{src:n.posterImage,alt:n.name,width:"218",height:"327"})}),Object(ke.jsxs)("div",{className:"film-card__desc",children:[Object(ke.jsx)("h2",{className:"film-card__title",children:n.name}),Object(ke.jsxs)("p",{className:"film-card__meta",children:[Object(ke.jsx)("span",{className:"film-card__genre",children:n.genre}),Object(ke.jsx)("span",{className:"film-card__year",children:n.released})]}),Object(ke.jsxs)("div",{className:"film-card__buttons",children:[Object(ke.jsxs)("button",{className:"btn btn--play film-card__button",type:"button",onClick:function(){return l.push(Object(o.f)(F,{id:n.id}))},children:[Object(ke.jsx)("svg",{viewBox:"0 0 19 19",width:"19",height:"19",children:Object(ke.jsx)("use",{xlinkHref:"#play-s"})}),Object(ke.jsx)("span",{children:"Play"})]}),Object(ke.jsx)(Pe,{film:n})]})]})]})})]}),Object(ke.jsxs)("div",{className:"page-content",children:[Object(ke.jsxs)("section",{className:"catalog",children:[Object(ke.jsx)("h2",{className:"catalog__title visually-hidden",children:"Catalog"}),Object(ke.jsx)(ze,{films:a,currentGenre:i,onGenreChange:s}),Object(ke.jsx)("div",{className:"catalog__films-list",children:Object(ke.jsx)(Ae,{films:r.slice(0,u)})}),Object(ke.jsx)("div",{className:"catalog__more",children:u<r.length?Object(ke.jsx)(Ye,{onShowMoreClick:function(){m(u+8)}}):""})]}),Object(ke.jsx)(Be,{})]})]})}));var He=Object(l.b)((function(e){return{authorizationStatus:ye(e)}}),(function(e){return{onSubmit:function(t){e(function(e){var t=e.login,a=e.password;return function(e,i,c){return c.post(L,{email:t,password:a}).then((function(e){var t=e.data;return localStorage.setItem("token",t.token)})).then((function(){return e(re(M))}))}}(t))}}}))((function(e){var t=e.authorizationStatus,a=e.onSubmit,i=Object(c.useRef)(),s=Object(c.useRef)(),r=Object(c.useState)({isEmailError:!1,isPasswordError:!1}),n=Object(Re.a)(r,2),l=n[0],d=n[1];return fe(t)?Object(ke.jsx)(o.a,{to:y}):Object(ke.jsxs)("div",{className:"user-page",children:[Object(ke.jsxs)("header",{className:"page-header user-page__head",children:[Object(ke.jsx)(qe,{}),Object(ke.jsx)("h1",{className:"page-title user-page__title",children:"Sign in"})]}),Object(ke.jsx)("div",{className:"sign-in user-page__content",children:Object(ke.jsxs)("form",{action:"#",className:"sign-in__form",children:[l.isEmailError?Object(ke.jsx)("div",{className:"sign-in__message",children:Object(ke.jsx)("p",{children:"Please enter a valid email address"})}):"",l.isPasswordError?Object(ke.jsx)("div",{className:"sign-in__message",children:Object(ke.jsxs)("p",{children:["We can\u2019t recognize this email ",Object(ke.jsx)("br",{})," and password combination. Please try again."]})}):"",Object(ke.jsxs)("div",{className:"sign-in__fields",children:[Object(ke.jsxs)("div",{className:"sign-in__field",children:[Object(ke.jsx)("input",{ref:i,className:"sign-in__input",type:"email",placeholder:"Email address",name:"user-email",id:"user-email","data-testid":"login"}),Object(ke.jsx)("label",{className:"sign-in__label visually-hidden",htmlFor:"user-email",children:"Email address"})]}),Object(ke.jsxs)("div",{className:"sign-in__field",children:[Object(ke.jsx)("input",{ref:s,className:"sign-in__input",type:"password",placeholder:"Password",name:"user-password",id:"user-password","data-testid":"password"}),Object(ke.jsx)("label",{className:"sign-in__label visually-hidden",htmlFor:"user-password",children:"Password"})]})]}),Object(ke.jsx)("div",{className:"sign-in__submit",children:Object(ke.jsx)("button",{className:"sign-in__btn",type:"submit",onClick:function(e){e.preventDefault(),/^[\w-.]+@[\w-]+\.[a-z]{2,4}$/i.test(i.current.value)?0!==s.current.value.trim().length?a({login:i.current.value,password:s.current.value}):d(Object(H.a)(Object(H.a)({},l),{},{isPasswordError:!0})):d(Object(H.a)(Object(H.a)({},l),{},{isEmailError:!0}))},children:"Sign in"})})]})}),Object(ke.jsx)(Be,{})]})}));var Ue=Object(l.b)((function(e){return{favoriteFilms:pe(e)}}),(function(e){return{loadData:function(){e(Me())}}}))((function(e){var t=e.favoriteFilms,a=e.loadData;return Object(c.useEffect)((function(){a()}),[a]),Object(ke.jsxs)("div",{className:"user-page",children:[Object(ke.jsxs)("header",{className:"page-header user-page__head",children:[Object(ke.jsx)(qe,{}),Object(ke.jsx)("h1",{className:"page-title user-page__title",children:"My list"}),Object(ke.jsx)(Le,{})]}),Object(ke.jsxs)("section",{className:"catalog",children:[Object(ke.jsx)("h2",{className:"catalog__title visually-hidden",children:"Catalog"}),Object(ke.jsx)("div",{className:"catalog__films-list",children:Object(ke.jsx)(Ae,{films:t})})]}),Object(ke.jsx)(Be,{})]})})),Xe=(V.a.shape({id:V.a.number.isRequired,rating:V.a.number.isRequired,comment:V.a.string.isRequired,date:V.a.string.isRequired,user:V.a.shape({id:V.a.number.isRequired,name:V.a.string.isRequired}).isRequired}).isRequired,function(e){return e[ue].reviews});var Je=function(e){var t,a=e.film;return Object(ke.jsxs)(ke.Fragment,{children:[Object(ke.jsxs)("div",{className:"film-rating",children:[Object(ke.jsx)("div",{className:"film-rating__score",children:a.rating}),Object(ke.jsxs)("p",{className:"film-rating__meta",children:[Object(ke.jsx)("span",{className:"film-rating__level",children:(t=a.rating,Math.trunc(t)===v?f:Math.trunc(t)>=p?O:Math.trunc(t)>=N?_:Math.trunc(t)>=w?x:g)}),Object(ke.jsxs)("span",{className:"film-rating__count",children:[a.scoresCount," ratings"]})]})]}),Object(ke.jsxs)("div",{className:"film-card__text",children:[Object(ke.jsx)("p",{children:a.description}),Object(ke.jsx)("p",{className:"film-card__director",children:Object(ke.jsxs)("strong",{children:["Director: ",a.director]})}),Object(ke.jsx)("p",{className:"film-card__starring",children:Object(ke.jsxs)("strong",{children:["Starring: ",a.starring.slice(0,3).join(", ")," and other"]})})]})]})};var Ke=function(e){var t=e.film;return Object(ke.jsxs)("div",{className:"film-card__text film-card__row",children:[Object(ke.jsxs)("div",{className:"film-card__text-col",children:[Object(ke.jsxs)("p",{className:"film-card__details-item",children:[Object(ke.jsx)("strong",{className:"film-card__details-name",children:"Director"}),Object(ke.jsx)("span",{className:"film-card__details-value",children:t.director})]}),Object(ke.jsxs)("p",{className:"film-card__details-item",children:[Object(ke.jsx)("strong",{className:"film-card__details-name",children:"Starring"}),Object(ke.jsx)("span",{className:"film-card__details-value",children:t.starring.slice().join(",_").split("_").map((function(e){return Object(ke.jsxs)(s.a.Fragment,{children:[e,Object(ke.jsx)("br",{})]},e)}))})]})]}),Object(ke.jsxs)("div",{className:"film-card__text-col",children:[Object(ke.jsxs)("p",{className:"film-card__details-item",children:[Object(ke.jsx)("strong",{className:"film-card__details-name",children:"Run Time"}),Object(ke.jsxs)("span",{className:"film-card__details-value",children:[0===Math.floor(t.runTime/60)?"":"".concat(Math.floor(t.runTime/60),"h ")," ",t.runTime%60,"m"]})]}),Object(ke.jsxs)("p",{className:"film-card__details-item",children:[Object(ke.jsx)("strong",{className:"film-card__details-name",children:"Genre"}),Object(ke.jsx)("span",{className:"film-card__details-value",children:t.genre})]}),Object(ke.jsxs)("p",{className:"film-card__details-item",children:[Object(ke.jsx)("strong",{className:"film-card__details-name",children:"Released"}),Object(ke.jsx)("span",{className:"film-card__details-value",children:t.released})]})]})]})},$e=a(20),Qe=a.n($e),Ze=a(17),et=a.n(Ze);var tt=function(e){var t=e.reviews;return Object(ke.jsxs)("div",{className:"film-card__reviews film-card__row",children:[Object(ke.jsx)("div",{className:"film-card__reviews-col",children:t.slice(0,Math.ceil(t.length/2)).map((function(e){return Object(ke.jsxs)("div",{className:"review",children:[Object(ke.jsxs)("blockquote",{className:"review__quote",children:[Object(ke.jsx)("p",{className:"review__text",children:e.comment}),Object(ke.jsxs)("footer",{className:"review__details",children:[Object(ke.jsx)("cite",{className:"review__author",children:e.user.name}),Object(ke.jsx)("time",{className:"review__date",dateTime:Qe()(e.date).format("YYYY-MM-DD"),children:Object(ke.jsx)(et.a,{format:"MMMM D, YYYY",children:e.date})})]})]}),Object(ke.jsx)("div",{className:"review__rating",children:e.rating})]},e.id)}))}),Object(ke.jsx)("div",{className:"film-card__reviews-col",children:t.slice(Math.ceil(t.length/2)).map((function(e){return Object(ke.jsxs)("div",{className:"review",children:[Object(ke.jsxs)("blockquote",{className:"review__quote",children:[Object(ke.jsx)("p",{className:"review__text",children:e.comment}),Object(ke.jsxs)("footer",{className:"review__details",children:[Object(ke.jsx)("cite",{className:"review__author",children:e.user.name}),Object(ke.jsx)("time",{className:"review__date",dateTime:Qe()(e.date).format("YYYY-MM-DD"),children:Object(ke.jsx)(et.a,{format:"MMMM D, YYYY",children:e.date})})]})]}),Object(ke.jsx)("div",{className:"review__rating",children:e.rating})]},e.id)}))})]})};var at=function(e){var t=e.film,a=e.reviews,i=Object(c.useState)(I.OVERVIEW),s=Object(Re.a)(i,2),r=s[0],n=s[1],l=Object.values(I),o=function(e){e.preventDefault(),n(e.target.innerText)};return Object(ke.jsxs)("div",{className:"film-card__desc",children:[Object(ke.jsx)("nav",{className:"film-nav film-card__nav",children:Object(ke.jsx)("ul",{className:"film-nav__list",children:l.map((function(e){return Object(ke.jsx)("li",{className:e===r?"film-nav__item film-nav__item--active":"film-nav__item",children:Object(ke.jsx)("a",{href:"/",className:"film-nav__link",onClick:o,children:e})},e)}))})}),r===I.OVERVIEW&&Object(ke.jsx)(Je,{film:t}),r===I.DETAILS&&Object(ke.jsx)(Ke,{film:t}),r===I.REVIEWS&&Object(ke.jsx)(tt,{reviews:a})]})};var it=Object(l.b)((function(e){return{film:xe(e),similarFilms:ve(e),reviews:Xe(e),authorizationStatus:ye(e)}}),(function(e){return{loadData:function(t){var a;e((a=t,function(e,t,i){return i.get("".concat(q,"/").concat(a)).then((function(t){var a=t.data;return e(ce(De(a)))})).catch((function(){return e(ne(E))}))})),e(Ie(t)),e(function(e){return function(t,a,i){return i.get("".concat(Y,"/").concat(e)).then((function(e){var a=e.data;return t(se(a))}))}}(t))}}}))((function(e){var t=e.film,a=e.similarFilms,i=e.reviews,s=e.loadData,r=e.authorizationStatus,n=parseInt(Object(o.i)().id,10),l=Object(o.h)(),d=a.filter((function(e){return e.id!==n})).slice(0,4);return Object(c.useEffect)((function(){if(s(n),n!==t.id)return Object(ke.jsx)(Ve,{})}),[n,t.id,s]),Object(ke.jsxs)(ke.Fragment,{children:[Object(ke.jsxs)("section",{className:"film-card film-card--full",children:[Object(ke.jsxs)("div",{className:"film-card__hero",children:[Object(ke.jsx)("div",{className:"film-card__bg",children:Object(ke.jsx)("img",{src:t.backgroundImage,alt:t.name})}),Object(ke.jsx)("h1",{className:"visually-hidden",children:"WTW"}),Object(ke.jsxs)("header",{className:"page-header film-card__head",children:[Object(ke.jsx)(qe,{}),Object(ke.jsx)(Le,{})]}),Object(ke.jsx)("div",{className:"film-card__wrap",children:Object(ke.jsxs)("div",{className:"film-card__desc",children:[Object(ke.jsx)("h2",{className:"film-card__title",children:t.name}),Object(ke.jsxs)("p",{className:"film-card__meta",children:[Object(ke.jsx)("span",{className:"film-card__genre",children:t.genre}),Object(ke.jsx)("span",{className:"film-card__year",children:t.released})]}),Object(ke.jsxs)("div",{className:"film-card__buttons",children:[Object(ke.jsxs)("button",{className:"btn btn--play film-card__button",type:"button",onClick:function(){return l.push(Object(o.f)(F,{id:n}))},children:[Object(ke.jsx)("svg",{viewBox:"0 0 19 19",width:19,height:19,children:Object(ke.jsx)("use",{xlinkHref:"#play-s"})}),Object(ke.jsx)("span",{children:"Play"})]}),Object(ke.jsx)(Pe,{film:t}),fe(r)?Object(ke.jsx)(Te.a,{className:"btn film-card__button",to:Object(o.f)("/films/:id/review",{id:n}),children:"Add review"}):""]})]})})]}),Object(ke.jsx)("div",{className:"film-card__wrap film-card__translate-top",children:Object(ke.jsxs)("div",{className:"film-card__info",children:[Object(ke.jsx)("div",{className:"film-card__poster film-card__poster--big",children:Object(ke.jsx)("img",{src:t.posterImage,alt:"The Grand Budapest Hotel poster",width:218,height:327})}),t.id?Object(ke.jsx)(at,{film:t,reviews:i}):""]})})]}),Object(ke.jsxs)("div",{className:"page-content",children:[Object(ke.jsxs)("section",{className:"catalog catalog--like-this",children:[d.length?Object(ke.jsx)("h2",{className:"catalog__title",children:"More like this"}):"",Object(ke.jsx)("div",{className:"catalog__films-list",children:Object(ke.jsx)(Ae,{films:d})})]}),Object(ke.jsx)(Be,{})]})]})}));var ct=function(e){var t=e.index,a=e.value,i=e.handleRatingChange,c=e.isDisabled;return Object(ke.jsxs)(ke.Fragment,{children:[Object(ke.jsx)("input",{className:"rating__input",id:"star-".concat(t),type:"radio",name:"rating",defaultValue:t,checked:a===t,onChange:i,disabled:c}),Object(ke.jsxs)("label",{className:"rating__label",htmlFor:"star-".concat(t),children:["Rating ",t]})]})};var st=Object(l.b)(null,(function(e){return{onSubmit:function(t,a){e(function(e,t){var a=e.id,i=e.rating,c=e.comment;return function(e,s,r){return r.post("".concat(Y,"/").concat(a),{rating:i,comment:c}).then((function(t){var a=t.data;return e(se(a))})).then((function(){return e(ne("".concat(q,"/").concat(a)))})).catch((function(){return t()}))}}(t,a))}}}))((function(e){var t=e.id,a=e.onSubmit,i=Object(c.useState)({rating:7,comment:"",isButtonDisabled:!0,isFormDisabled:!1,isSubmitError:!1}),s=Object(Re.a)(i,2),r=s[0],n=s[1],l=r.rating,o=r.comment,d=function(e){n(Object(H.a)(Object(H.a)({},r),{},{rating:Number(e.target.value)}))},j=function(){n(Object(H.a)(Object(H.a)({},r),{},{isSubmitError:!0,isFormDisabled:!0})),setTimeout((function(){n(Object(H.a)(Object(H.a)({},r),{},{isSubmitError:!1,isFormDisabled:!1}))}),4500)};return Object(ke.jsxs)("form",{action:"#",className:"add-review__form",onSubmit:function(e){e.preventDefault(),n(Object(H.a)(Object(H.a)({},r),{},{isFormDisabled:!0})),a({id:t,rating:r.rating,comment:r.comment},j)},children:[Object(ke.jsx)("div",{className:"rating",children:Object(ke.jsx)("div",{className:"rating__stars",children:Array.from({length:10}).map((function(e,t){var a="".concat(e,"-").concat(t);return Object(ke.jsx)(ct,{index:10-t,value:l,handleRatingChange:d,isDisabled:r.isFormDisabled},a)}))})}),Object(ke.jsxs)("div",{className:"add-review__text",children:[Object(ke.jsx)("textarea",{className:"add-review__textarea",name:"review-text",id:"review-text",cols:30,placeholder:"Review text",value:o,maxLength:400,onInput:function(e){var t=e.target.value.length;n(t>=50?Object(H.a)(Object(H.a)({},r),{},{isButtonDisabled:!1,comment:e.target.value}):Object(H.a)(Object(H.a)({},r),{},{isButtonDisabled:!0,comment:e.target.value}))},disabled:r.isFormDisabled}),Object(ke.jsx)("div",{className:"add-review__submit",children:r.isSubmitError?Object(ke.jsx)("p",{style:{color:"#FF0000"},children:"\u041e\u0448\u0438\u0431\u043a\u0430 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u043e\u0442\u0437\u044b\u0432\u0430"}):Object(ke.jsx)("button",{className:"add-review__btn",type:"submit",disabled:r.isButtonDisabled||r.isFormDisabled,children:"Post"})})]})]})}));var rt=function(e){var t=e.films,a=parseInt(Object(o.i)().id,10),i=t.find((function(e){return e.id===a}));return Object(ke.jsxs)("section",{className:"film-card film-card--full",children:[Object(ke.jsxs)("div",{className:"film-card__header",children:[Object(ke.jsx)("div",{className:"film-card__bg",children:Object(ke.jsx)("img",{src:i.backgroundImage,alt:i.name})}),Object(ke.jsx)("h1",{className:"visually-hidden",children:"WTW"}),Object(ke.jsxs)("header",{className:"page-header",children:[Object(ke.jsx)(qe,{}),Object(ke.jsx)("nav",{className:"breadcrumbs",children:Object(ke.jsxs)("ul",{className:"breadcrumbs__list",children:[Object(ke.jsx)("li",{className:"breadcrumbs__item",children:Object(ke.jsx)(Te.a,{to:Object(o.f)("/films/:id/",{id:a}),className:"breadcrumbs__link",children:i.name})}),Object(ke.jsx)("li",{className:"breadcrumbs__item",children:Object(ke.jsx)("a",{className:"breadcrumbs__link",href:"/",onClick:function(e){return e.preventDefault()},children:"Add review"})})]})}),Object(ke.jsx)(Le,{})]}),Object(ke.jsx)("div",{className:"film-card__poster film-card__poster--small",children:Object(ke.jsx)("img",{src:i.posterImage,alt:i.name,width:218,height:327})})]}),Object(ke.jsx)("div",{className:"add-review",children:Object(ke.jsx)(st,{id:a})})]})},nt=a(37);var lt=function(e){var t=e.films,a=parseInt(Object(o.i)().id,10),i=t.find((function(e){return e.id===a})),s=Object(o.h)(),r=Object(c.useRef)(),n=Object(c.useRef)(),l=Object(c.useRef)(),d=Object(c.useState)({isPlaying:!1,elapsedTime:""}),j=Object(Re.a)(d,2),u=j[0],m=j[1],b=u.isPlaying,h=i.runTime,f=Object(nt.a)({duration:60*h,isPlaying:b}).elapsedTime,O=Math.ceil(60*h-f);return Object(ke.jsxs)("div",{className:"player",children:[Object(ke.jsx)("video",{ref:r,src:i.videoLink,className:"player__video",poster:i.posterImage}),Object(ke.jsx)("button",{type:"button",className:"player__exit",onClick:function(){return s.push(Object(o.f)(R,{id:a}))},children:"Exit"}),Object(ke.jsxs)("div",{className:"player__controls",children:[Object(ke.jsxs)("div",{className:"player__controls-row",children:[Object(ke.jsxs)("div",{className:"player__time",children:[Object(ke.jsx)("progress",{className:"player__progress",value:30,max:100}),Object(ke.jsx)("div",{className:"player__toggler",style:{left:"".concat(Math.floor(f/(60*h)*100))},children:"Toggler"})]}),Object(ke.jsx)("div",{className:"player__time-value",children:Object(ke.jsx)(et.a,{unix:!0,format:"-HH:mm:ss",children:O})})]}),Object(ke.jsxs)("div",{className:"player__controls-row",children:[Object(ke.jsxs)("button",{ref:n,type:"button",className:"player__play",onClick:function(e){e.preventDefault(),r.current.paused?(r.current.play(),m((function(e){return Object(H.a)(Object(H.a)({},e),{},{isPlaying:!0})}))):(r.current.pause(),m((function(e){return Object(H.a)(Object(H.a)({},e),{},{isPlaying:!1})})))},children:[Object(ke.jsx)("svg",{viewBox:"0 0 19 19",width:19,height:19,children:Object(ke.jsx)("use",{xlinkHref:u.isPlaying?"#pause":"#play-s"})}),Object(ke.jsx)("span",{children:"Play"})]}),Object(ke.jsx)("div",{className:"player__name",children:i.name}),Object(ke.jsxs)("button",{ref:l,type:"button",className:"player__full-screen",onClick:function(e){e.preventDefault(),r.current.requestFullscreen()},children:[Object(ke.jsx)("svg",{viewBox:"0 0 27 27",width:27,height:27,children:Object(ke.jsx)("use",{xlinkHref:"#full-screen"})}),Object(ke.jsx)("span",{children:"Full screen"})]})]})]})]})};var ot=function(){return Object(ke.jsxs)("div",{className:"user-page",children:[Object(ke.jsxs)("section",{children:[Object(ke.jsx)("h1",{children:"404. Page not found"}),Object(ke.jsx)("a",{href:y,children:"\u0412\u0435\u0440\u043d\u0443\u0442\u044c\u0441\u044f \u043d\u0430 \u0433\u043b\u0430\u0432\u043d\u0443\u044e"})]}),Object(ke.jsx)(Be,{})]})};var dt=Object(l.b)((function(e){return{films:_e(e),authorizationStatus:ye(e),isDataLoaded:we(e)}}),null)((function(e){var t=e.films,a=e.authorizationStatus,i=e.isDataLoaded;return a!==T&&i?Object(ke.jsxs)(o.d,{children:[Object(ke.jsx)(o.b,{exact:!0,path:y,children:Object(ke.jsx)(Ge,{})}),Object(ke.jsx)(o.b,{exact:!0,path:k,children:Object(ke.jsx)(He,{})}),Object(ke.jsx)(Se,{exact:!0,path:S,render:function(){return Object(ke.jsx)(Ue,{films:t})}}),Object(ke.jsx)(o.b,{exact:!0,path:R,children:Object(ke.jsx)(it,{films:t})}),Object(ke.jsx)(Se,{exact:!0,path:D,render:function(){return Object(ke.jsx)(rt,{films:t})}}),Object(ke.jsx)(o.b,{exact:!0,path:F,children:Object(ke.jsx)(lt,{films:t})}),Object(ke.jsx)(o.b,{children:Object(ke.jsx)(ot,{path:E})})]}):Object(ke.jsx)(Ve,{})})),jt=a(36),ut=a.n(jt),mt=401,bt=204,ht=Object(u.createStore)(be,Object(b.composeWithDevTools)(Object(u.applyMiddleware)(m.a.withExtraArgument(function(e){var t,a=null!==(t=localStorage.getItem("token"))&&void 0!==t?t:"",i=ut.a.create({baseURL:"https://7.react.pages.academy/wtw",timeout:5e3,headers:{"X-Token":a}});return i.interceptors.response.use((function(e){var t=e.data;return t.token&&!localStorage.getItem("token")&&(i.defaults.headers.common["X-token"]=t.token,localStorage.setItem("token",t.token)),e.status===bt&&(i.defaults.headers.common["X-token"]="",localStorage.setItem("token","")),e}),(function(t){throw t.response.status===mt&&e(),t})),i}((function(){return ht.dispatch(re(C))})))),Object(u.applyMiddleware)((function(e){return function(e){return function(t){return t.type===ie&&j.push(t.payload),e(t)}}}))));ht.dispatch((function(e,t,a){return a.get(L).then((function(){return e(re(M))})).catch((function(){}))})),ht.dispatch((function(e,t,a){return a.get(q).then((function(t){var a,i=t.data;return e((a=Fe(i),{type:J,payload:a}))}))})),n.a.render(Object(ke.jsx)(s.a.StrictMode,{children:Object(ke.jsx)(l.a,{store:ht,children:Object(ke.jsx)(o.c,{history:j,children:Object(ke.jsx)(dt,{})})})}),document.getElementById("root")),window.onbeforeunload=function(e){(e||window.event)&&j.push(y),j.push(y)}}},[[67,1,2]]]);
//# sourceMappingURL=main.3ac929d0.chunk.js.map